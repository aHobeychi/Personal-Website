(function(){const t=100,s=50,o=300,n=120,i=200;document.addEventListener("DOMContentLoaded",function(){setTimeout(e,t),document.body.addEventListener("htmx:afterSwap",function(n){n.detail.target.id==="content-section"&&setTimeout(e,t)}),document.body.addEventListener("htmx:afterSettle",function(t){t.detail.target.id==="variable-sidebar-container"&&setTimeout(e,s)})});function a(){window.scrollSpyActive&&(window.scrollObserver&&(window.scrollObserver.disconnect(),window.scrollObserver=null),window.removeEventListener("resize",window.scrollSpyResizeHandler),window.removeEventListener("scroll",window.scrollSpyScrollHandler),window.scrollSpyActive=!1)}function e(){try{const r=document.querySelectorAll(".blog-toc .toc-list a"),d=document.querySelector("article");if(!r.length||!d)return;const u={};r.forEach(e=>{const t=e.getAttribute("href");t&&t.startsWith("#")&&(u[t.substring(1)]=!0)});const c=Array.from(d.querySelectorAll("[id]")).filter(e=>u[e.id]);if(!c.length)return;a();let l=null;const s=[];function t(){s.length=0,c.forEach(e=>{s.push({id:e.id,top:e.getBoundingClientRect().top+window.scrollY})}),s.sort((e,t)=>e.top-t.top)}t();function e(){const t=window.scrollY;let e=null;for(let o=s.length-1;o>=0;o--)if(t+n>=s[o].top){e=s[o].id;break}if(!e&&s.length>0&&Math.abs(t-s[0].top)<i&&(e=s[0].id),e){const t=document.getElementById(e);if(!l||e!==l.id){r.forEach(e=>{e.classList.remove("active")});const n=document.querySelector(`.blog-toc .toc-list a[href="#${e}"]`);n&&(n.classList.add("active"),l=t)}}}const h={rootMargin:`-${n}px 0px -70% 0px`,threshold:[0,.1,.5,1]};window.scrollObserver=new IntersectionObserver(t=>{window.scrollSpyAnimating||(window.scrollSpyAnimating=!0,window.requestAnimationFrame(()=>{t.some(e=>e.isIntersecting)&&e(),window.scrollSpyAnimating=!1}))},h),c.forEach(e=>{window.scrollObserver.observe(e)}),window.scrollSpyResizeHandler=function(){t(),e()},window.addEventListener("resize",window.scrollSpyResizeHandler,{passive:!0}),window.scrollSpyActive=!0,window.addEventListener("load",function(){t(),e()}),setTimeout(function(){t(),e()},o),window.scrollSpyScrollHandler=function(){window.scrollSpyAnimating||(window.scrollSpyAnimating=!0,window.requestAnimationFrame(function(){e(),window.scrollSpyAnimating=!1}))},window.addEventListener("scroll",window.scrollSpyScrollHandler,{passive:!0})}catch(e){console.error("Error initializing scroll spy:",e)}}})()