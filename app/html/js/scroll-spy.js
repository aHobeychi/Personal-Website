document.addEventListener("DOMContentLoaded",function(){setTimeout(initScrollSpy,100),document.body.addEventListener("htmx:afterSwap",function(e){e.detail.target.id==="content-section"&&(console.log("HTMX content swap detected, reinitializing scroll spy"),setTimeout(initScrollSpy,200))}),document.body.addEventListener("htmx:afterSettle",function(e){e.detail.target.id==="variable-sidebar-container"&&(console.log("TOC loaded via HTMX, initializing scroll spy"),setTimeout(initScrollSpy,50))})});function initScrollSpy(){console.log("Initializing Scroll Spy");const t=document.querySelectorAll(".blog-toc .toc-list a"),o=document.querySelector("article");if(console.log("TOC Links found:",t.length),console.log("Article found:",!!o),!t.length||!o){console.log("Scroll Spy waiting: Missing TOC or article");return}const r={};t.forEach(e=>{const t=e.getAttribute("href");t&&t.startsWith("#")&&(r[t.substring(1)]=!0)});const i=Array.from(o.querySelectorAll("[id]")).filter(e=>r[e.id]);if(console.log("TOC Headings found:",i.length),!i.length){console.log("Scroll Spy exiting: No headings with IDs found in TOC");return}window.scrollSpyActive&&(console.log("Cleaning up previous scroll spy"),window.removeEventListener("scroll",window.scrollSpyScrollHandler),window.removeEventListener("resize",window.scrollSpyResizeHandler));let a=null;const l=30,c=120,e=[];function n(){e.length=0,i.forEach(t=>{e.push({id:t.id,top:t.getBoundingClientRect().top+window.scrollY})}),e.sort((e,t)=>e.top-t.top)}n();function s(){const s=window.scrollY;let n=null;for(let t=e.length-1;t>=0;t--)if(s+c>=e[t].top){n=e[t].id;break}if(!n&&e.length>0&&Math.abs(s-e[0].top)<200&&(n=e[0].id),n){const e=document.getElementById(n);if(!a||n!==a.id){t.forEach(e=>{e.classList.remove("active")});const s=document.querySelector(`.blog-toc .toc-list a[href="#${n}"]`);s&&(s.classList.add("active"),a=e)}}}window.scrollSpyScrollHandler=function(){window.scrollSpyAnimating||(window.scrollSpyAnimating=!0,window.requestAnimationFrame(function(){s(),window.scrollSpyAnimating=!1}))},window.scrollSpyResizeHandler=function(){n(),s()},window.addEventListener("scroll",window.scrollSpyScrollHandler),window.addEventListener("resize",window.scrollSpyResizeHandler),window.scrollSpyActive=!0,window.addEventListener("load",function(){n(),s()}),setTimeout(function(){n(),s(),console.log("Scroll Spy initialized successfully")},300)}